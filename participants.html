<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Participant List</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Russo+One&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0f1014; color: #fff; font-family: 'Montserrat', sans-serif; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .page-title { text-align: center; font-family: 'Russo One'; margin-bottom: 30px; font-size: 2rem; }
        
        .card-list { display: flex; flex-direction: column; gap: 15px; }
        
        /* Card Style untuk setiap user */
        .runner-card { 
            background: #1a1c23; padding: 20px; border-radius: 10px; border: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .runner-info h3 { margin: 0 0 5px 0; font-size: 1.1rem; }
        .runner-meta { color: #888; font-size: 0.9rem; }
        
        .badge { padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; }
        .pending { background: #333; color: #ccc; }
        .paid { background: #ff0000; color: #fff; box-shadow: 0 0 10px rgba(255,0,0,0.4); }

        .back-link { display: block; margin-bottom: 20px; color: #ff0000; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <a href="index.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Home</a>
        <h1 class="page-title">Registered Participants</h1>

        <div id="loading" style="text-align:center;">Loading list...</div>
        <div id="listContainer" class="card-list">
            </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // CONFIG SAMA
        const firebaseConfig = {
            apiKey: "AIzaSyBZzcjRx3KhBaHaahSUee1ySRIlRgVmi3o",
            authDomain: "sea-mountain.firebaseapp.com",
            databaseURL: "https://sea-mountain-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "sea-mountain",
            storageBucket: "sea-mountain.firebasestorage.app",
            messagingSenderId: "812228825024",
            appId: "1:812228825024:web:717049c1a64b39c8a60225"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const dbRef = ref(db, 'registrations');

        onValue(dbRef, (snapshot) => {
            const data = snapshot.val();
            const container = document.getElementById('listContainer');
            document.getElementById('loading').style.display = 'none';
            container.innerHTML = "";

            if (data) {
                Object.keys(data).forEach(eventId => {
                    const eventData = data[eventId];
                    Object.values(eventData).forEach(runner => {
                        
                        let statusBadge = `<span class="badge pending">Pending</span>`;
                        if(runner.status === 'Paid') {
                            statusBadge = `<span class="badge paid">CONFIRMED <i class="fas fa-check"></i></span>`;
                        }

                        // Mask Email (sorok sikit privacy)
                        // const maskedEmail = runner.email.replace(/(.{2})(.*)(?=@)/, "$1***");

                        const card = `
                            <div class="runner-card">
                                <div class="runner-info">
                                    <h3>${runner.first_name} ${runner.last_name}</h3>
                                    <div class="runner-meta">
                                        <span style="color:#ff0000; font-weight:bold;">${eventId.toUpperCase()}</span> | 
                                        ${runner.category} | ${runner.tshirt_size}
                                    </div>
                                </div>
                                <div>${statusBadge}</div>
                            </div>
                        `;
                        container.innerHTML += card;
                    });
                });
            } else {
                container.innerHTML = "<p style='text-align:center'>No participants yet.</p>";
            }
        });
    </script>
</body>
</html>